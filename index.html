<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NStarX Portal</title>
    <link rel="stylesheet" href="https://unpkg.com/tuicss@2.1.1/dist/tuicss.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200">
    <style>
        @font-face {
            font-family: 'PerfectDOS';
            src: url('https://unpkg.com/perfect-dos-vga-437@1.0.0/fonts/Perfect%20DOS%20VGA%20437.ttf') format('truetype');
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'PerfectDOS', 'Courier New', monospace;
            font-size: 16px;
            background: #0000aa;
            color: #ffff54;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* Menu Bar */
        .menu-bar {
            background: #00aaaa;
            color: #000;
            padding: 0;
            display: flex;
            line-height: 1;
        }

        .menu-item {
            padding: 0.25em 1em;
            cursor: pointer;
        }

        .menu-item:hover, .menu-item.active {
            background: #000;
            color: #00aaaa;
        }

        .menu-item .highlight {
            color: #aa0000;
        }

        .menu-item:hover .highlight {
            color: #ff5555;
        }

        .menu-spacer {
            flex: 1;
        }

        /* Main Area */
        .main-area {
            flex: 1;
            display: flex;
            flex-direction: column;
            padding: 0.5em;
            position: relative;
        }

        /* Window */
        .window {
            background: #0000aa;
            border: 2px solid #00aaaa;
            position: relative;
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .window::before {
            content: '';
            position: absolute;
            top: 2px;
            left: 2px;
            right: -4px;
            bottom: -4px;
            background: #000;
            z-index: -1;
        }

        .window-title {
            position: absolute;
            top: -0.6em;
            left: 1em;
            background: #0000aa;
            padding: 0 0.5em;
            color: #00aaaa;
        }

        .window-title .num {
            color: #aaaaaa;
        }

        .window-controls {
            position: absolute;
            top: -0.6em;
            right: 1em;
            background: #0000aa;
            padding: 0 0.25em;
            display: flex;
            gap: 0.5em;
        }

        .window-controls span {
            color: #00aaaa;
            cursor: pointer;
        }

        .window-controls span:hover {
            color: #55ffff;
        }

        /* Content */
        .content {
            flex: 1;
            padding: 1em;
            overflow-y: auto;
        }

        /* Resource List */
        .resource-list {
            display: flex;
            flex-direction: column;
        }

        .resource-item {
            display: flex;
            padding: 0.125em 0.5em;
            text-decoration: none;
            color: #ffff54;
            cursor: pointer;
        }

        .resource-item:hover, .resource-item.selected {
            background: #00aaaa;
            color: #000;
        }

        .resource-item:hover .item-badge {
            color: #000;
        }

        .item-num {
            width: 2em;
            color: #aaaaaa;
        }

        .resource-item:hover .item-num {
            color: #000;
        }

        .item-icon {
            width: 2.5em;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .material-symbols-outlined {
            font-size: 1.2em;
            vertical-align: middle;
        }

        .item-title {
            flex: 1;
        }

        .item-badge {
            color: #55ff55;
            margin-left: 1em;
        }

        /* Scroll indicators */
        .scroll-bar {
            position: absolute;
            right: 0;
            top: 1.5em;
            bottom: 0;
            width: 1em;
            background: #00aaaa;
            display: flex;
            flex-direction: column;
        }

        .scroll-arrow {
            text-align: center;
            color: #000;
            cursor: pointer;
            line-height: 1;
        }

        .scroll-track {
            flex: 1;
            background: #008888;
            position: relative;
        }

        .scroll-thumb {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 2em;
            background: #00aaaa;
        }

        /* Status Bar */
        .status-bar {
            background: #00aaaa;
            color: #000;
            padding: 0.25em 1em;
            display: flex;
            justify-content: space-between;
            line-height: 1;
        }

        .status-bar .highlight {
            color: #aa0000;
        }

        /* Help Line */
        .help-line {
            background: #000;
            color: #00aaaa;
            padding: 0.25em 0;
            display: flex;
            justify-content: center;
            gap: 2em;
            font-size: 0.9em;
            line-height: 1;
        }

        .help-item .key {
            color: #aaaaaa;
        }

        /* Dialog overlay */
        .dialog-overlay {
            position: fixed;
            inset: 0;
            background: transparent;
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 100;
        }

        .dialog-overlay.active {
            display: flex;
        }

        /* TuiCss overrides for dialogs */
        .tui-window.dialog-box {
            min-width: 45em;
            max-width: 90vw;
        }

        .tui-window.dialog-box fieldset {
            background: #aaaaaa;
            margin: 0;
        }

        .dialog-body {
            padding: 1em;
        }

        .dialog-footer {
            padding: 0.5em 1em 1em;
            display: flex;
            justify-content: center;
            gap: 1em;
        }

        .form-row {
            display: flex;
            align-items: center;
            margin-bottom: 0.5em;
        }

        .form-row label {
            width: 10em;
            text-align: right;
            padding-right: 1em;
        }

        .form-row input,
        .form-row select {
            flex: 1;
        }

        .tui-fieldset legend {
            background: #00aaaa;
            color: #000;
            padding: 0.1em 0.5em;
        }

        @media (max-width: 600px) {
            body {
                font-size: 12px;
            }

            .menu-item {
                padding: 0.25em 0.5em;
            }

            .help-line {
                flex-wrap: wrap;
                gap: 0.5em 1em;
            }

            .tui-window.dialog-box {
                min-width: 95vw;
                max-width: 95vw;
            }

            .form-row {
                flex-direction: column;
                align-items: stretch;
            }

            .form-row label {
                width: auto;
                text-align: left;
                padding: 0 0 0.25em 0;
            }
        }
    </style>
</head>
<body>
    <!-- Menu Bar -->
    <div class="menu-bar">
        <div class="menu-item" onclick="showAddDialog()"><span class="highlight">A</span>dd</div>
        <div class="menu-item" onclick="showExportDialog()">E<span class="highlight">x</span>port</div>
        <div class="menu-item" onclick="clearLocalData()"><span class="highlight">C</span>lear Local</div>
        <div class="menu-spacer"></div>
        <div class="menu-item" onclick="showHelp()"><span class="highlight">H</span>elp</div>
        <div class="menu-item" onclick="window.location.href='index_old.html'"><span class="highlight">O</span>ld Site</div>
    </div>

    <!-- Main Area -->
    <div class="main-area">
        <div class="window">
            <span class="window-title"><span class="num">[1]</span> NSTARX.PAS</span>
            <div class="window-controls">
                <span>[â†‘]</span>
                <span>[â– ]</span>
            </div>

            <div class="content">
                <div class="resource-list" id="links-grid">
                    <div class="resource-item">Loading resources...</div>
                </div>
            </div>

            <div class="scroll-bar">
                <div class="scroll-arrow">â–²</div>
                <div class="scroll-track">
                    <div class="scroll-thumb"></div>
                </div>
                <div class="scroll-arrow">â–¼</div>
            </div>
        </div>
    </div>

    <!-- Status Bar -->
    <div class="status-bar">
        <span><span class="highlight">â– </span> Ready</span>
        <span id="item-count">0 resources</span>
        <span>v<span id="version">1.0</span></span>
    </div>

    <!-- Help Line -->
    <div class="help-line">
        <span class="help-item"><span class="key">F1</span> Help</span>
        <span class="help-item"><span class="key">F2</span> Add</span>
        <span class="help-item"><span class="key">F5</span> Refresh</span>
        <span class="help-item"><span class="key">1-9</span> Open</span>
        <span class="help-item"><span class="key">â†‘â†“</span> Navigate</span>
        <span class="help-item"><span class="key">Esc</span> Close</span>
    </div>

    <!-- Help Dialog -->
    <div class="dialog-overlay" id="help-dialog">
        <div class="tui-window dialog-box tui-shadow">
            <fieldset class="tui-fieldset">
                <legend class="center">Help</legend>
                <div class="dialog-body">
                    <pre style="margin: 0;">
 â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
 â•‘  NSTARX PORTAL v1.0                   â•‘
 â•‘  Quick access to all resources        â•‘
 â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
 â•‘  KEYBOARD SHORTCUTS:                  â•‘
 â•‘                                       â•‘
 â•‘  1-9 ......... Open resource directly â•‘
 â•‘  â†‘/â†“ ......... Navigate list          â•‘
 â•‘  Enter ....... Open selected item     â•‘
 â•‘  F1 .......... Show this help         â•‘
 â•‘  F2 .......... Add new resource       â•‘
 â•‘  F5 .......... Refresh page           â•‘
 â•‘  Esc ......... Close dialog           â•‘
 â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                    </pre>
                </div>
                <div class="dialog-footer">
                    <button class="tui-button" onclick="closeDialog('help-dialog')">OK</button>
                </div>
            </fieldset>
        </div>
    </div>

    <!-- Add Dialog -->
    <div class="dialog-overlay" id="add-dialog">
        <div class="tui-window dialog-box tui-shadow">
            <fieldset class="tui-fieldset">
                <legend class="center">Add New Resource</legend>
                <div class="dialog-body">
                    <div class="form-row">
                        <label for="add-title">Title:</label>
                        <input type="text" id="add-title" class="tui-input" placeholder="My Resource">
                    </div>
                    <div class="form-row">
                        <label for="add-url">URL:</label>
                        <input type="text" id="add-url" class="tui-input" placeholder="https://example.com">
                    </div>
                    <div class="form-row">
                        <label for="add-desc">Description:</label>
                        <input type="text" id="add-desc" class="tui-input" placeholder="Brief description">
                    </div>
                    <div class="form-row">
                        <label for="add-badge">Badge:</label>
                        <select id="add-badge" class="tui-input">
                            <option value="App">App</option>
                            <option value="Documentation">Documentation</option>
                            <option value="Live Demo">Live Demo</option>
                            <option value="UI Demo">UI Demo</option>
                            <option value="API Reference">API Reference</option>
                            <option value="Compliance">Compliance</option>
                            <option value="AI Agents">AI Agents</option>
                        </select>
                    </div>
                    <div class="form-row">
                        <label for="add-icon">Icon:</label>
                        <select id="add-icon" class="tui-input">
                            <option value="description">Description/Docs</option>
                            <option value="dns">Server</option>
                            <option value="cloud">Cloud</option>
                            <option value="api">API</option>
                            <option value="lock">Security</option>
                            <option value="smart_toy">AI/Robot</option>
                            <option value="rocket_launch">Launch</option>
                            <option value="settings">Settings</option>
                            <option value="dashboard">Dashboard</option>
                            <option value="link">Link</option>
                            <option value="folder">Folder</option>
                            <option value="code">Code</option>
                            <option value="terminal">Terminal</option>
                            <option value="storage">Database</option>
                        </select>
                    </div>
                    <p style="margin-top: 1em; font-size: 0.9em;">
                        * Saved to localStorage. Use Export to save permanently.
                    </p>
                </div>
                <div class="dialog-footer">
                    <button class="tui-button" onclick="saveNewResource()">Save</button>
                    <button class="tui-button" onclick="closeDialog('add-dialog')">Cancel</button>
                </div>
            </fieldset>
        </div>
    </div>

    <!-- Export Dialog -->
    <div class="dialog-overlay" id="export-dialog">
        <div class="tui-window dialog-box tui-shadow" style="min-width: 55em;">
            <fieldset class="tui-fieldset">
                <legend class="center">Export Local Resources</legend>
                <div class="dialog-body">
                    <p style="margin-bottom: 0.5em;">Copy this JSON and add to data.json "links" array:</p>
                    <textarea id="export-json" class="tui-input" style="width: 100%; height: 12em; font-family: monospace;" readonly></textarea>
                </div>
                <div class="dialog-footer">
                    <button class="tui-button" onclick="copyExport()">Copy</button>
                    <button class="tui-button" onclick="closeDialog('export-dialog')">Close</button>
                </div>
            </fieldset>
        </div>
    </div>

    <script>
        let items = [];
        let localItems = [];
        let selectedIndex = 0;
        let mouseEnabled = false;
        const LOCAL_STORAGE_KEY = 'nstarx_local_resources';

        async function loadPortal() {
            try {
                const response = await fetch('data.json');
                const data = await response.json();

                document.getElementById('version').textContent = data.portal.version;
                document.title = 'NSTARX.PAS - ' + data.portal.title;

                // Load from data.json
                const jsonItems = data.links.filter(link => link.enabled);

                // Load from localStorage
                localItems = JSON.parse(localStorage.getItem(LOCAL_STORAGE_KEY) || '[]');

                // Merge: local items first, then json items
                items = [...localItems, ...jsonItems];
                document.getElementById('item-count').textContent = items.length + ' resources';

                renderList();

                // Enable mouse selection after initial render
                setTimeout(() => { mouseEnabled = true; }, 100);
            } catch (error) {
                document.getElementById('links-grid').innerHTML = `
                    <div class="resource-item" style="color: #ff5555;">
                        Error loading data. Press F5 to retry.
                    </div>
                `;
            }
        }

        // Map emojis to Material Icons
        const iconMap = {
            'ğŸ“š': 'description',
            'ğŸ–¥ï¸': 'dns',
            'â˜ï¸': 'cloud',
            'ğŸ”Œ': 'api',
            'ğŸ”’': 'lock',
            'ğŸ¤–': 'smart_toy',
            'ğŸš€': 'rocket_launch',
            'âš™ï¸': 'settings',
            'ğŸ“Š': 'dashboard',
            'ğŸ”—': 'link'
        };

        function getIcon(icon) {
            // If it's already a material icon name, use it
            if (icon && !icon.match(/[\u{1F300}-\u{1F9FF}]/u)) {
                return `<span class="material-symbols-outlined">${icon}</span>`;
            }
            // Map emoji to material icon
            const mapped = iconMap[icon] || 'link';
            return `<span class="material-symbols-outlined">${mapped}</span>`;
        }

        function renderList() {
            const grid = document.getElementById('links-grid');

            grid.innerHTML = items.map((link, i) => {
                const num = i + 1;
                const isLocal = link.isLocal ? ' *' : '';
                return `
                    <a href="${link.url}" class="resource-item ${i === selectedIndex ? 'selected' : ''}" target="_blank" data-index="${i}">
                        <span class="item-num">${num <= 9 ? num + ')' : '  '}</span>
                        <span class="item-icon">${getIcon(link.icon)}</span>
                        <span class="item-title">${link.title}${isLocal}</span>
                        <span class="item-badge">[${link.badge}]</span>
                    </a>
                `;
            }).join('');
        }

        function updateSelection() {
            document.querySelectorAll('.resource-item').forEach((el, i) => {
                el.classList.toggle('selected', i === selectedIndex);
            });
            document.querySelectorAll('.resource-item')[selectedIndex]?.scrollIntoView({ block: 'nearest' });
        }

        // Dialog functions
        function showDialog(id) {
            document.getElementById(id).classList.add('active');
        }

        function closeDialog(id) {
            document.getElementById(id).classList.remove('active');
        }

        function closeAllDialogs() {
            document.querySelectorAll('.dialog-overlay').forEach(d => d.classList.remove('active'));
        }

        function isDialogOpen() {
            return document.querySelector('.dialog-overlay.active') !== null;
        }

        function showHelp() {
            showDialog('help-dialog');
        }

        function showAddDialog() {
            // Clear form
            document.getElementById('add-title').value = '';
            document.getElementById('add-url').value = '';
            document.getElementById('add-desc').value = '';
            document.getElementById('add-badge').value = 'App';
            document.getElementById('add-icon').value = 'description';
            showDialog('add-dialog');
            setTimeout(() => document.getElementById('add-title').focus(), 100);
        }

        function saveNewResource() {
            const title = document.getElementById('add-title').value.trim();
            const url = document.getElementById('add-url').value.trim();
            const desc = document.getElementById('add-desc').value.trim();
            const badge = document.getElementById('add-badge').value;
            const icon = document.getElementById('add-icon').value;

            if (!title || !url) {
                alert('Title and URL are required!');
                return;
            }

            const newItem = {
                id: 'local_' + Date.now(),
                title: title,
                shortTitle: title,
                description: desc || title,
                url: url,
                displayUrl: url.replace(/^https?:\/\//, '').split('/')[0],
                badge: badge,
                icon: icon,
                enabled: true,
                isLocal: true
            };

            localItems.push(newItem);
            localStorage.setItem(LOCAL_STORAGE_KEY, JSON.stringify(localItems));

            // Refresh list
            items = [...localItems, ...items.filter(i => !i.isLocal)];
            document.getElementById('item-count').textContent = items.length + ' resources';
            renderList();

            closeDialog('add-dialog');
        }

        function showExportDialog() {
            const exportData = localItems.map(item => {
                const { isLocal, ...cleanItem } = item;
                return cleanItem;
            });

            document.getElementById('export-json').value = JSON.stringify(exportData, null, 2);
            showDialog('export-dialog');
        }

        function copyExport() {
            const textarea = document.getElementById('export-json');
            textarea.select();
            document.execCommand('copy');
            alert('Copied to clipboard!');
        }

        function clearLocalData() {
            if (localItems.length === 0) {
                alert('No local resources to clear.');
                return;
            }
            if (confirm('Clear all locally added resources? (' + localItems.length + ' items)')) {
                localStorage.removeItem(LOCAL_STORAGE_KEY);
                localItems = [];
                items = items.filter(i => !i.isLocal);
                document.getElementById('item-count').textContent = items.length + ' resources';
                renderList();
            }
        }

        // Keyboard
        document.addEventListener('keydown', (e) => {
            // If any dialog is open
            if (isDialogOpen()) {
                if (e.key === 'Escape') {
                    e.preventDefault();
                    closeAllDialogs();
                }
                return;
            }

            // Number keys 1-9
            if (e.key >= '1' && e.key <= '9' && !e.ctrlKey && !e.metaKey && document.activeElement.tagName !== 'INPUT') {
                const index = parseInt(e.key) - 1;
                if (items[index]) {
                    window.open(items[index].url, '_blank');
                }
                return;
            }

            // Arrow keys
            if (e.key === 'ArrowDown') {
                e.preventDefault();
                selectedIndex = Math.min(selectedIndex + 1, items.length - 1);
                updateSelection();
            } else if (e.key === 'ArrowUp') {
                e.preventDefault();
                selectedIndex = Math.max(selectedIndex - 1, 0);
                updateSelection();
            }

            // Enter
            if (e.key === 'Enter' && items[selectedIndex] && document.activeElement.tagName !== 'INPUT') {
                window.open(items[selectedIndex].url, '_blank');
            }

            // F1 - Help
            if (e.key === 'F1') {
                e.preventDefault();
                showHelp();
            }

            // F2 - Add
            if (e.key === 'F2') {
                e.preventDefault();
                showAddDialog();
            }

            // F5 - Refresh
            if (e.key === 'F5') {
                e.preventDefault();
                location.reload();
            }
        });

        // Mouse hover selection (only after initial render)
        document.getElementById('links-grid').addEventListener('mouseover', (e) => {
            if (!mouseEnabled) return;
            const item = e.target.closest('.resource-item');
            if (item && item.dataset.index !== undefined) {
                selectedIndex = parseInt(item.dataset.index);
                updateSelection();
            }
        });

        loadPortal();
    </script>
</body>
</html>
