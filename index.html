<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NStarX Quick Links Portal</title>
    
    <!-- TuiCss CSS (loaded conditionally) -->
    <link id="tuicss-stylesheet" rel="stylesheet" href="https://unpkg.com/tuicss@2.1.1/dist/tuicss.min.css" disabled>
    
    <style id="modern-styles">
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background-color: #1a0f2e;
            min-height: 100vh;
            padding: 40px 20px;
            position: relative;
            overflow-x: hidden;
        }

        /* Loading screen */
        .loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: #1a0f2e;
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            transition: opacity 0.5s ease;
        }

        .loading-screen.hidden {
            opacity: 0;
            pointer-events: none;
        }

        .loading-content {
            text-align: center;
            color: white;
        }

        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 3px solid rgba(102, 126, 234, 0.3);
            border-top: 3px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Isogrid background - very subtle */
        body::after {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: url('isogrid-large.png');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            opacity: 0.03;
            pointer-events: none;
            z-index: -4;
        }

        /* Cardinal Compass Background */
        .compass-background {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 600px;
            height: 600px;
            pointer-events: none;
            z-index: -3;
            opacity: 0.5;
        }

        .compass-background svg {
            width: 100%;
            height: 100%;
        }

        @media (max-width: 768px) {
            .compass-background {
                width: 400px;
                height: 400px;
            }
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 20% 50%, rgba(102, 126, 234, 0.4) 0%, transparent 40%),
                radial-gradient(circle at 80% 50%, rgba(118, 75, 162, 0.4) 0%, transparent 40%),
                radial-gradient(circle at 50% 50%, rgba(138, 92, 182, 0.3) 0%, transparent 60%);
            pointer-events: none;
            z-index: -1;
            mix-blend-mode: screen;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            margin-bottom: 60px;
            animation: fadeInDown 0.8s ease;
        }

        .header h1 {
            color: white;
            font-size: 3rem;
            margin-bottom: 10px;
            text-shadow: 
                3px 3px 0 #667eea,
                6px 6px 0 #764ba2,
                9px 9px 0 rgba(0, 0, 0, 0.5),
                9px 9px 10px rgba(0, 0, 0, 0.3);
            font-family: 'Courier New', monospace;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 4px;
            transform: perspective(300px) rotateY(-5deg);
            display: inline-block;
            position: relative;
        }

        .header h1::after {
            content: ' █';
            position: absolute;
            right: -50px;
            top: 0;
            color: #00ff00;
            text-shadow: 
                0 0 5px #00ff00,
                0 0 10px #00ff00,
                0 0 15px #00ff00,
                3px 3px 0 #667eea,
                6px 6px 0 #764ba2;
            animation: blink 1s infinite;
            font-size: 3rem;
            transition: opacity 0.2s ease;
            opacity: 1;
        }
        
        .header h1.cursor-hidden::after {
            opacity: 0;
            animation: none;
        }

        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0; }
        }

        .header p {
            color: rgba(255, 255, 255, 0.9);
            font-size: 1.2rem;
            font-family: 'Courier New', monospace;
            text-transform: uppercase;
            letter-spacing: 2px;
            text-shadow: 
                2px 2px 0 rgba(102, 126, 234, 0.5),
                4px 4px 0 rgba(0, 0, 0, 0.3);
        }

        .links-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 30px;
            animation: fadeInUp 0.8s ease;
        }

        .link-card {
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(10px);
            border-radius: 0;
            padding: 30px;
            box-shadow: 
                4px 4px 0 rgba(0, 0, 0, 0.2),
                8px 8px 0 rgba(102, 126, 234, 0.1);
            transition: all 0.3s ease;
            cursor: pointer;
            text-decoration: none;
            display: block;
            position: relative;
            overflow: visible;
            border: 2px solid #667eea;
        }
        
        .link-card .hover-cursor {
            position: absolute;
            bottom: 10px;
            right: 10px;
            color: #00ff00;
            font-size: 2rem;
            font-family: 'Courier New', monospace;
            text-shadow: 
                0 0 5px #00ff00,
                0 0 10px #00ff00,
                0 0 15px #00ff00,
                2px 2px 0 #667eea;
            z-index: 10;
            pointer-events: none;
            display: none;
        }
        
        .link-card:hover .hover-cursor {
            display: block;
            animation: blink 1s infinite;
        }

        .link-card::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image: 
                repeating-linear-gradient(
                    0deg,
                    transparent,
                    transparent 4px,
                    rgba(102, 126, 234, 0.05) 4px,
                    rgba(102, 126, 234, 0.05) 8px
                ),
                repeating-linear-gradient(
                    90deg,
                    transparent,
                    transparent 4px,
                    rgba(118, 75, 162, 0.05) 4px,
                    rgba(118, 75, 162, 0.05) 8px
                );
            background-size: 8px 8px, 8px 8px;
            opacity: 0;
            transition: opacity 0.3s ease;
            pointer-events: none;
            z-index: 1;
        }

        .link-card:hover {
            transform: translate(-4px, -4px);
            box-shadow: 
                8px 8px 0 rgba(0, 0, 0, 0.3),
                16px 16px 0 rgba(102, 126, 234, 0.2);
            animation: pixelShift 0.3s infinite steps(4);
        }

        .link-card:hover::after {
            opacity: 1;
            animation: scanlines 1s infinite linear;
        }

        @keyframes pixelShift {
            0% { background-position: 0 0; }
            25% { background-position: 2px 0; }
            50% { background-position: 2px 2px; }
            75% { background-position: 0 2px; }
            100% { background-position: 0 0; }
        }

        @keyframes scanlines {
            0% { background-position: 0 0, 0 0; }
            100% { background-position: 0 8px, 8px 0; }
        }

        .link-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: linear-gradient(90deg, #667eea, #764ba2);
        }

        .icon-wrapper {
            width: 80px;
            height: 80px;
            margin-bottom: 20px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            border-radius: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 
                4px 4px 0 rgba(0, 0, 0, 0.3),
                8px 8px 0 rgba(102, 126, 234, 0.2);
            image-rendering: pixelated;
            image-rendering: -moz-crisp-edges;
            image-rendering: crisp-edges;
            position: relative;
            z-index: 2;
        }

        .icon-wrapper::before {
            content: '';
            position: absolute;
            inset: 0;
            background: 
                repeating-linear-gradient(
                    0deg,
                    transparent,
                    transparent 4px,
                    rgba(255, 255, 255, 0.1) 4px,
                    rgba(255, 255, 255, 0.1) 8px
                );
            pointer-events: none;
        }

        .icon {
            width: 50px;
            height: 50px;
            fill: white;
            image-rendering: pixelated;
            image-rendering: -moz-crisp-edges;
            image-rendering: crisp-edges;
            filter: contrast(1.2);
        }

        .link-card h2 {
            color: #333;
            font-size: 1.5rem;
            margin-bottom: 10px;
            font-family: 'Courier New', monospace;
            font-weight: bold;
            text-shadow: 
                1px 1px 0 rgba(102, 126, 234, 0.3),
                2px 2px 0 rgba(102, 126, 234, 0.1);
            letter-spacing: 1px;
            position: relative;
            z-index: 2;
        }

        .link-card .description {
            color: #666;
            font-size: 1rem;
            line-height: 1.6;
            margin-bottom: 15px;
            position: relative;
            z-index: 2;
        }

        .link-card .url {
            color: #667eea;
            font-size: 0.9rem;
            word-break: break-all;
            position: relative;
            z-index: 2;
        }

        /* Enhanced Status Badge Styles */
        .status-badge {
            position: absolute;
            top: 15px;
            right: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 6px 12px;
            border-radius: 20px;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            box-shadow: 
                0 2px 10px rgba(0, 0, 0, 0.1),
                0 0 0 1px rgba(0, 0, 0, 0.05);
            z-index: 10;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            font-family: 'Courier New', monospace;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            cursor: pointer;
            user-select: none;
        }
        
        .status-badge:active {
            transform: scale(0.95);
        }

        .status-badge:hover {
            transform: translateY(-2px);
            box-shadow: 
                0 4px 15px rgba(0, 0, 0, 0.15),
                0 0 0 1px rgba(0, 0, 0, 0.05);
        }

        /* Status Indicator Dot */
        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            position: relative;
            display: inline-block;
        }

        .status-dot::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 100%;
            height: 100%;
            border-radius: 50%;
            background: inherit;
            animation: ping 2s cubic-bezier(0, 0, 0.2, 1) infinite;
        }

        @keyframes ping {
            75%, 100% {
                transform: translate(-50%, -50%) scale(2);
                opacity: 0;
            }
        }

        /* Status Text */
        .status-label {
            display: inline-block;
            line-height: 1;
        }

        /* Checking State */
        .status-badge.checking {
            background: linear-gradient(135deg, rgba(255, 193, 7, 0.1), rgba(255, 152, 0, 0.1));
            border: 1px solid rgba(255, 152, 0, 0.3);
            color: #f57c00;
        }

        .status-badge.checking .status-dot {
            background: #ff9800;
            animation: spin-dot 1s linear infinite;
        }

        @keyframes spin-dot {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .status-badge.checking .status-label::after {
            content: '...';
            display: inline-block;
            width: 20px;
            text-align: left;
            animation: dots 1.5s steps(4, end) infinite;
        }

        @keyframes dots {
            0%, 20% { content: '.'; }
            40% { content: '..'; }
            60%, 100% { content: '...'; }
        }

        /* Online State */
        .status-badge.online {
            background: linear-gradient(135deg, rgba(76, 175, 80, 0.1), rgba(67, 160, 71, 0.15));
            border: 1px solid rgba(76, 175, 80, 0.3);
            color: #2e7d32;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { 
                opacity: 0;
                transform: scale(0.9);
            }
            to { 
                opacity: 1;
                transform: scale(1);
            }
        }

        .status-badge.online .status-dot {
            background: #4caf50;
            box-shadow: 0 0 0 1px rgba(76, 175, 80, 0.4);
        }

        .status-badge.online .status-dot::before {
            animation: ping-success 2s cubic-bezier(0, 0, 0.2, 1) infinite;
        }

        @keyframes ping-success {
            75%, 100% {
                transform: translate(-50%, -50%) scale(2.5);
                opacity: 0;
            }
        }

        /* Offline State */
        .status-badge.offline {
            background: linear-gradient(135deg, rgba(244, 67, 54, 0.1), rgba(229, 57, 53, 0.15));
            border: 1px solid rgba(244, 67, 54, 0.3);
            color: #c62828;
            animation: shake 0.5s ease;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-2px); }
            75% { transform: translateX(2px); }
        }

        .status-badge.offline .status-dot {
            background: #f44336;
            box-shadow: 0 0 0 1px rgba(244, 67, 54, 0.4);
            animation: pulse-error 2s ease-in-out infinite;
        }

        @keyframes pulse-error {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(0.95); opacity: 0.9; }
        }

        /* Response Time Display */
        .response-time {
            font-size: 0.65rem;
            opacity: 0.7;
            margin-left: 4px;
            padding: 1px 4px;
            background: rgba(0, 0, 0, 0.05);
            border-radius: 8px;
            cursor: help;
        }

        .status-badge.online .response-time {
            background: rgba(76, 175, 80, 0.1);
            color: #2e7d32;
        }

        /* Icon for status */
        .status-icon {
            width: 14px;
            height: 14px;
            display: inline-block;
            margin-right: 2px;
        }

        .status-badge.online .status-icon svg {
            fill: #4caf50;
        }

        .status-badge.offline .status-icon svg {
            fill: #f44336;
        }

        .status-badge.checking .status-icon svg {
            fill: #ff9800;
        }

        .badge {
            display: inline-block;
            padding: 4px 12px;
            background: rgba(102, 126, 234, 0.1);
            color: #667eea;
            border-radius: 0;
            font-size: 0.85rem;
            margin-top: 10px;
            border: 2px solid #667eea;
            font-family: 'Courier New', monospace;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 1px;
            box-shadow: 2px 2px 0 rgba(102, 126, 234, 0.3);
        }

        @keyframes fadeInDown {
            from {
                opacity: 0;
                transform: translateY(-30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 2rem;
            }
            .links-grid {
                grid-template-columns: 1fr;
            }
            .ui-controls {
                right: 10px !important;
                top: 10px !important;
                max-width: calc(100vw - 20px) !important;
                gap: 8px !important;
            }
            .ui-toggle {
                padding: 8px 12px !important;
                font-size: 0.75rem !important;
                min-width: 100px !important;
            }
        }
        
        @media (max-width: 480px) {
            .ui-controls {
                flex-direction: column;
                align-items: stretch;
            }
            .ui-toggle {
                width: 100%;
                text-align: center;
            }
        }
    </style>

    <style id="terminal-styles" disabled>
        /* Hide modern UI completely when in terminal mode */
        body.terminal-mode .container {
            display: none !important;
            visibility: hidden !important;
        }

        body.terminal-mode .compass-background {
            display: none !important;
            visibility: hidden !important;
        }

        body.terminal-mode {
            background-color: #000084 !important;
            padding: 20px !important;
            font-family: 'DOS', monospace !important;
            min-height: 100vh !important;
            background-image: 
                repeating-linear-gradient(
                    0deg,
                    transparent,
                    transparent 2px,
                    rgba(0, 0, 0, 0.1) 2px,
                    rgba(0, 0, 0, 0.1) 4px
                ) !important;
        }

        body.terminal-mode::before,
        body.terminal-mode::after {
            display: none !important;
        }

        /* Terminal UI Styles */
        .terminal-ui {
            display: none !important;
        }

        .terminal-mode .terminal-ui {
            display: block !important;
        }

        .terminal-mode .loading-screen {
            display: none !important;
        }

        .tui-window {
            margin-bottom: 20px;
            background-color: #c0c0c0;
            border: none !important;
        }
        
        .tui-window fieldset.tui-fieldset {
            margin: 0;
            padding: 0;
            border: 6px double #ffffff;
            box-sizing: border-box;
            height: 100%;
            width: 100%;
        }

        .main-container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header-window {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .header-window fieldset.tui-fieldset {
            padding: 20px;
        }

        .title-text {
            font-size: 2.5rem;
            font-weight: bold;
            color: #000084;
            text-shadow: 2px 2px 0px #ffffff;
            letter-spacing: 4px;
            margin: 20px 0;
            animation: blink 2s step-start infinite;
        }

        .subtitle {
            color: #000000;
            font-size: 1rem;
            letter-spacing: 2px;
            margin-bottom: 20px;
        }

        .links-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .link-window {
            transition: transform 0.2s ease;
            cursor: pointer;
            text-decoration: none;
            display: block;
        }

        .link-window:hover {
            transform: translate(-2px, -2px);
        }

        .link-window .tui-window {
            height: 100%;
            display: flex;
            flex-direction: column;
        }

        .link-content {
            padding: 15px;
            padding-bottom: 5px;
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            box-sizing: border-box;
        }

        .icon-ascii {
            font-size: 2rem;
            margin-bottom: 10px;
            color: #000084;
            font-weight: bold;
            display: block;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        .link-title {
            font-size: 1.2rem;
            font-weight: bold;
            color: #000000;
            margin-bottom: 10px;
            text-transform: uppercase;
        }

        .link-description {
            color: #404040;
            font-size: 0.9rem;
            line-height: 1.4;
            margin-bottom: 10px;
            flex-grow: 1;
        }

        .link-url {
            color: #000084;
            font-size: 0.8rem;
            word-break: break-all;
            border-top: 1px dotted #808080;
            padding-top: 10px;
            margin-top: auto;
        }

        /* Enhanced Terminal Mode Status */
        .terminal-status {
            display: inline-block;
            margin-left: 10px;
            padding: 3px 8px;
            font-size: 0.8rem;
            font-weight: bold;
            border: 2px solid;
            position: relative;
        }

        .terminal-status::before {
            content: '';
            display: inline-block;
            width: 6px;
            height: 6px;
            border-radius: 50%;
            margin-right: 5px;
            vertical-align: middle;
        }

        .terminal-status.checking {
            background: #333300;
            color: #ffff00;
            border-color: #ffff00;
            animation: terminal-blink 1s steps(2, start) infinite;
        }

        .terminal-status.checking::before {
            background: #ffff00;
            animation: terminal-pulse 1s infinite;
        }

        .terminal-status.online {
            background: #003300;
            color: #00ff00;
            border-color: #00ff00;
            text-shadow: 0 0 5px #00ff00;
        }

        .terminal-status.online::before {
            background: #00ff00;
            box-shadow: 0 0 5px #00ff00;
        }

        .terminal-status.offline {
            background: #330000;
            color: #ff0000;
            border-color: #ff0000;
            text-shadow: 0 0 5px #ff0000;
        }

        .terminal-status.offline::before {
            background: #ff0000;
            box-shadow: 0 0 5px #ff0000;
        }

        @keyframes terminal-blink {
            50% { opacity: 0.5; }
        }

        @keyframes terminal-pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.5); }
        }

        .badge-container {
            margin-top: 10px;
            margin-bottom: 10px;
        }

        .tui-statusbar {
            background-color: #000084;
            color: #ffffff;
            margin-top: 10px;
        }

        /* ASCII Art Background */
        .ascii-decoration {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 10rem;
            color: rgba(0, 0, 132, 0.05);
            z-index: -1;
            font-weight: bold;
            letter-spacing: 20px;
            pointer-events: none;
            animation: rotate 60s linear infinite;
        }

        @keyframes rotate {
            from { transform: translate(-50%, -50%) rotate(0deg); }
            to { transform: translate(-50%, -50%) rotate(360deg); }
        }

        /* Terminal cursor effect */
        .cursor::after {
            content: '_';
            animation: cursor-blink 1s step-start infinite;
            font-weight: bold;
            color: #00ff00;
        }

        @keyframes cursor-blink {
            50% { opacity: 0; }
        }

        /* DOS-style navigation bar */
        .nav-bar {
            background-color: #c0c0c0;
            border: 2px solid;
            border-color: #ffffff #808080 #808080 #ffffff;
            padding: 2px;
            margin-bottom: 20px;
        }

        .nav-item {
            display: inline-block;
            padding: 5px 15px;
            margin: 2px;
            background-color: #c0c0c0;
            border: 2px solid;
            border-color: #ffffff #808080 #808080 #ffffff;
            cursor: pointer;
            text-decoration: none;
            color: #000000;
            font-weight: bold;
        }

        .nav-item:hover {
            background-color: #000084;
            color: #ffffff;
        }

        .nav-item:active {
            border-color: #808080 #ffffff #ffffff #808080;
        }
    </style>

    <style>
        /* UI Controls Container */
        .ui-controls {
            position: fixed;
            top: 20px;
            right: 20px;
            display: flex;
            gap: 10px;
            z-index: 9999;
            flex-wrap: wrap;
            justify-content: flex-end;
            max-width: 500px;
        }
        
        /* UI Toggle Button */
        .ui-toggle {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 10px 16px;
            font-family: 'Courier New', monospace;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-size: 0.82rem;
            cursor: pointer;
            box-shadow: 
                3px 3px 0 rgba(0, 0, 0, 0.3),
                6px 6px 0 rgba(102, 126, 234, 0.2);
            transition: all 0.3s ease;
            white-space: nowrap;
            border-radius: 0;
            min-width: 120px;
            text-align: center;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 5px;
        }

        .ui-toggle:hover {
            transform: translate(-2px, -2px);
            box-shadow: 
                6px 6px 0 rgba(0, 0, 0, 0.3),
                12px 12px 0 rgba(102, 126, 234, 0.2);
        }

        .ui-toggle:active {
            transform: translate(0, 0);
            box-shadow: 
                2px 2px 0 rgba(0, 0, 0, 0.3),
                4px 4px 0 rgba(102, 126, 234, 0.2);
        }

        .terminal-mode .ui-toggle {
            background: #c0c0c0 !important;
            color: #000000 !important;
            border: 2px solid !important;
            border-color: #ffffff #808080 #808080 #ffffff !important;
            box-shadow: none !important;
            position: relative !important;
        }

        .terminal-mode .ui-toggle:hover {
            background-color: #000084 !important;
            color: #ffffff !important;
            transform: none !important;
        }

        .terminal-mode .ui-toggle:active {
            border-color: #808080 #ffffff #ffffff #808080 !important;
        }

        /* Error message styling */
        .error-message {
            background-color: rgba(255, 0, 0, 0.1);
            border: 2px solid #ff0000;
            color: #ff0000;
            padding: 20px;
            margin: 20px;
            text-align: center;
            font-family: 'Courier New', monospace;
        }

        /* Ensure proper hiding of UIs */
        body:not(.terminal-mode) .terminal-ui {
            display: none !important;
            visibility: hidden !important;
            height: 0 !important;
            overflow: hidden !important;
        }

        body.terminal-mode .container,
        body.terminal-mode .compass-background {
            display: none !important;
            visibility: hidden !important;
            height: 0 !important;
            overflow: hidden !important;
        }
    </style>
</head>
<body>
    <!-- Loading Screen -->
    <div class="loading-screen" id="loadingScreen">
        <div class="loading-content">
            <div class="loading-spinner"></div>
            <p>Loading NStarX Portal...</p>
        </div>
    </div>

    <!-- UI Controls -->
    <div class="ui-controls">
        <button class="ui-toggle ping-console-btn" onclick="togglePingConsole()" title="Show/Hide ping console" style="
            background: linear-gradient(135deg, #2196f3, #1976d2);
        ">
            📟 Console
        </button>
        <button class="ui-toggle refresh-btn" onclick="refreshAllStatuses()" title="Refresh all status indicators" style="
            background: linear-gradient(135deg, #4caf50, #45a049);
        ">
            🔄 Refresh
        </button>
        <button class="ui-toggle" id="uiToggleBtn" onclick="toggleUI()">
            ⚡ Terminal
        </button>
    </div>
    
    <!-- Ping Console -->
    <div id="pingConsole" style="
        position: fixed;
        bottom: 20px;
        right: 20px;
        width: min(500px, calc(100vw - 40px));
        max-height: 300px;
        background: #000;
        color: #0f0;
        font-family: 'Courier New', monospace;
        font-size: 12px;
        border: 2px solid #0f0;
        border-radius: 4px;
        padding: 10px;
        overflow-y: auto;
        z-index: 9998;
        display: none;
        box-shadow: 0 0 20px rgba(0, 255, 0, 0.3);
    ">
        <div style="border-bottom: 1px solid #0f0; padding-bottom: 5px; margin-bottom: 10px;">
            <strong>📟 PING CONSOLE v1.0</strong>
            <button onclick="clearPingConsole()" style="
                float: right;
                background: transparent;
                color: #0f0;
                border: 1px solid #0f0;
                padding: 2px 8px;
                cursor: pointer;
                font-size: 10px;
            ">CLEAR</button>
        </div>
        <div id="pingOutput" style="white-space: pre-wrap; line-height: 1.4;"></div>
    </div>

    <!-- Modern UI -->
    <div class="container">
        <div class="header">
            <h1 id="portalTitle">NStarX Portal</h1>
            <p id="portalSubtitle">Quick access to all NStarX resources and documentation</p>
        </div>

        <div class="links-grid" id="modernLinksGrid">
            <!-- Links will be dynamically inserted here -->
        </div>
    </div>

    <!-- Cardinal Compass Background -->
    <div class="compass-background">
        <svg viewBox="0 0 600 600" xmlns="http://www.w3.org/2000/svg">
            <!-- Outer Circle -->
            <circle cx="300" cy="300" r="280" fill="none" stroke="#667eea" stroke-width="3" opacity="0.8"/>
            <circle cx="300" cy="300" r="250" fill="none" stroke="#764ba2" stroke-width="2" opacity="0.6"/>
            <circle cx="300" cy="300" r="220" fill="none" stroke="#667eea" stroke-width="2" opacity="0.4"/>
            
            <!-- Cardinal Lines -->
            <!-- North-South -->
            <line x1="300" y1="50" x2="300" y2="550" stroke="#667eea" stroke-width="4" opacity="0.9"/>
            <!-- East-West -->
            <line x1="50" y1="300" x2="550" y2="300" stroke="#667eea" stroke-width="4" opacity="0.9"/>
            
            <!-- Diagonal Lines -->
            <line x1="100" y1="100" x2="500" y2="500" stroke="#764ba2" stroke-width="2" opacity="0.5"/>
            <line x1="500" y1="100" x2="100" y2="500" stroke="#764ba2" stroke-width="2" opacity="0.5"/>
            
            <!-- Cardinal Points -->
            <!-- North -->
            <g transform="translate(300, 50)">
                <polygon points="0,-20 -15,15 0,5 15,15" fill="#667eea" opacity="1"/>
                <text x="0" y="-30" text-anchor="middle" font-family="Courier New, monospace" font-size="32" font-weight="bold" fill="#667eea" opacity="1">N</text>
            </g>
            
            <!-- South -->
            <g transform="translate(300, 550)">
                <polygon points="0,20 -15,-15 0,-5 15,-15" fill="#667eea" opacity="0.8"/>
                <text x="0" y="40" text-anchor="middle" font-family="Courier New, monospace" font-size="32" font-weight="bold" fill="#667eea" opacity="1">S</text>
            </g>
            
            <!-- East -->
            <g transform="translate(550, 300)">
                <polygon points="20,0 -15,-15 -5,0 -15,15" fill="#667eea" opacity="0.8"/>
                <text x="35" y="7" text-anchor="middle" font-family="Courier New, monospace" font-size="32" font-weight="bold" fill="#667eea" opacity="1">E</text>
            </g>
            
            <!-- West -->
            <g transform="translate(50, 300)">
                <polygon points="-20,0 15,-15 5,0 15,15" fill="#667eea" opacity="0.8"/>
                <text x="-35" y="7" text-anchor="middle" font-family="Courier New, monospace" font-size="32" font-weight="bold" fill="#667eea" opacity="1">W</text>
            </g>
            
            <!-- Center Star (North Star) -->
            <g transform="translate(300, 300)">
                <!-- Outer star glow -->
                <circle cx="0" cy="0" r="40" fill="url(#starGradient)" opacity="0.6"/>
                <!-- Star shape -->
                <path d="M 0,-25 L 6,-8 L 25,-4 L 9,9 L 12,25 L 0,15 L -12,25 L -9,9 L -25,-4 L -6,-8 Z" 
                      fill="#00ff00" opacity="1" stroke="#00ff00" stroke-width="2" filter="url(#glow)"/>
                <!-- Inner star -->
                <circle cx="0" cy="0" r="8" fill="#00ff00" opacity="1"/>
            </g>
            
            <!-- Gradient Definition -->
            <defs>
                <radialGradient id="starGradient">
                    <stop offset="0%" stop-color="#00ff00" stop-opacity="1"/>
                    <stop offset="50%" stop-color="#667eea" stop-opacity="0.6"/>
                    <stop offset="100%" stop-color="#764ba2" stop-opacity="0"/>
                </radialGradient>
                
                <!-- Glow filter for star -->
                <filter id="glow">
                    <feGaussianBlur stdDeviation="3" result="coloredBlur"/>
                    <feMerge>
                        <feMergeNode in="coloredBlur"/>
                        <feMergeNode in="SourceGraphic"/>
                    </feMerge>
                </filter>
                
                <!-- Subtle grid pattern -->
                <pattern id="gridPattern" x="0" y="0" width="50" height="50" patternUnits="userSpaceOnUse">
                    <line x1="0" y1="0" x2="0" y2="50" stroke="#667eea" stroke-width="1" opacity="0.3"/>
                    <line x1="0" y1="0" x2="50" y2="0" stroke="#667eea" stroke-width="1" opacity="0.3"/>
                </pattern>
            </defs>
            
            <!-- Background grid -->
            <rect x="0" y="0" width="600" height="600" fill="url(#gridPattern)"/>
            
            <!-- Decorative compass marks -->
            <g transform="translate(300, 300)">
                <!-- 30 degree marks -->
                <g opacity="0.5">
                    <line x1="0" y1="-180" x2="0" y2="-200" stroke="#667eea" stroke-width="2" transform="rotate(30)"/>
                    <line x1="0" y1="-180" x2="0" y2="-200" stroke="#667eea" stroke-width="2" transform="rotate(60)"/>
                    <line x1="0" y1="-180" x2="0" y2="-200" stroke="#667eea" stroke-width="2" transform="rotate(120)"/>
                    <line x1="0" y1="-180" x2="0" y2="-200" stroke="#667eea" stroke-width="2" transform="rotate(150)"/>
                    <line x1="0" y1="-180" x2="0" y2="-200" stroke="#667eea" stroke-width="2" transform="rotate(210)"/>
                    <line x1="0" y1="-180" x2="0" y2="-200" stroke="#667eea" stroke-width="2" transform="rotate(240)"/>
                    <line x1="0" y1="-180" x2="0" y2="-200" stroke="#667eea" stroke-width="2" transform="rotate(300)"/>
                    <line x1="0" y1="-180" x2="0" y2="-200" stroke="#667eea" stroke-width="2" transform="rotate(330)"/>
                </g>
            </g>
        </svg>
    </div>

    <!-- Terminal UI (Hidden by default) -->
    <div class="terminal-ui">
        <!-- ASCII Art Background -->
        <div class="ascii-decoration">★</div>
        
        <div class="main-container">
            <!-- Navigation Bar -->
            <div class="nav-bar" id="terminalNavBar">
                <!-- Navigation items will be dynamically inserted here -->
            </div>

            <!-- Header Window -->
            <div class="tui-window red-168 header-window">
                <fieldset class="tui-fieldset">
                    <legend class="center">═══ NSTARX PORTAL ═══</legend>
                    <div class="title-text"><span id="terminalTitle">NSTARX</span><span class="cursor"></span></div>
                    <div class="subtitle" id="terminalSubtitle">▓▒░ QUICK ACCESS TO ALL RESOURCES ░▒▓</div>
                    <div class="tui-divider"></div>
                    <p style="margin: 10px 0;" id="terminalWelcome">Welcome to the NStarX Portal Terminal Interface</p>
                    <p style="margin: 10px 0; color: #404040;" id="terminalStatus">System Ready. Select a destination below.</p>
                </fieldset>
            </div>

            <!-- Links Grid -->
            <div class="links-container" id="terminalLinksContainer">
                <!-- Terminal links will be dynamically inserted here -->
            </div>

            <!-- Footer Status Bar -->
            <div class="tui-window" style="margin-top: 40px;">
                <div class="tui-statusbar">
                    <ul id="footerStatusBar">
                        <li>F1=Help</li>
                        <li>F5=Refresh</li>
                        <li>ESC=Exit</li>
                        <li id="clock">--:--:--</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let portalData = null;
        let isTerminalMode = false;

        // Load JSON data
        async function loadPortalData() {
            try {
                const response = await fetch('data.json');
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                portalData = await response.json();
                initializePortal();
            } catch (error) {
                console.error('Error loading portal data:', error);
                showError('Failed to load portal data. Please refresh the page.');
            }
        }

        // Show error message
        function showError(message) {
            const loadingScreen = document.getElementById('loadingScreen');
            loadingScreen.innerHTML = `
                <div class="error-message">
                    <h2>Error</h2>
                    <p>${message}</p>
                </div>
            `;
        }

        // Initialize portal with loaded data
        function initializePortal() {
            if (!portalData) return;

            // Set portal titles and subtitles
            document.getElementById('portalTitle').textContent = portalData.portal.title;
            document.getElementById('portalSubtitle').textContent = portalData.portal.subtitle;
            document.getElementById('terminalTitle').textContent = portalData.portal.terminalTitle;
            document.getElementById('terminalSubtitle').textContent = portalData.portal.terminalSubtitle;
            document.getElementById('terminalWelcome').textContent = portalData.portal.terminalWelcome;
            document.getElementById('terminalStatus').textContent = portalData.portal.terminalStatus;

            // Generate modern UI links
            generateModernLinks();

            // Generate terminal UI links
            generateTerminalLinks();

            // Generate terminal navigation
            generateTerminalNav();

            // Setup keyboard shortcuts
            setupKeyboardShortcuts();

            // Hide loading screen
            setTimeout(() => {
                document.getElementById('loadingScreen').classList.add('hidden');
            }, 500);

            // Initialize UI features
            initializeUIFeatures();

            // Load saved UI preference
            loadUIPreference();
            
            // Start status monitoring after initialization
            startStatusMonitoring();
        }

        // Generate modern UI links
        function generateModernLinks() {
            const grid = document.getElementById('modernLinksGrid');
            grid.innerHTML = '';

            portalData.links.filter(link => link.enabled).forEach((link, index) => {
                const uniqueLinkId = `link-${index}`; // Always use index for unique ID
                const linkCard = document.createElement('a');
                linkCard.href = link.url;
                linkCard.className = 'link-card';
                linkCard.target = '_blank';
                linkCard.setAttribute('data-link-id', uniqueLinkId);
                linkCard.setAttribute('data-url', link.url);
                linkCard.innerHTML = `
                    <div class="status-badge checking" id="status-${uniqueLinkId}" 
                         onclick="event.preventDefault(); event.stopPropagation(); updateLinkStatus('${uniqueLinkId}', '${link.url}'); return false;"
                         title="Click to refresh status">
                        <span class="status-dot"></span>
                        <span class="status-label">Checking</span>
                    </div>
                    <span class="hover-cursor">█</span>
                    <div class="icon-wrapper">
                        <svg class="icon" viewBox="0 0 24 24">
                            <path d="${link.svgPath}"/>
                        </svg>
                    </div>
                    <h2>${link.title}</h2>
                    <p class="description">${link.description}</p>
                    <p class="url">${link.displayUrl}</p>
                    <span class="badge">${link.badge}</span>
                `;
                grid.appendChild(linkCard);
            });

            // Start status checking after a short delay to ensure DOM is ready
            setTimeout(() => {
                checkAllStatuses();
            }, 100);
        }

        // Generate terminal UI links
        function generateTerminalLinks() {
            const container = document.getElementById('terminalLinksContainer');
            container.innerHTML = '';

            portalData.links.filter(link => link.enabled).forEach((link, index) => {
                const uniqueLinkId = `link-${index}`; // Always use index for unique ID
                const linkWindow = document.createElement('a');
                linkWindow.href = link.url;
                linkWindow.className = 'link-window';
                linkWindow.target = '_blank';
                linkWindow.setAttribute('data-link-id', uniqueLinkId);
                linkWindow.setAttribute('data-url', link.url);
                
                linkWindow.innerHTML = `
                    <div class="tui-window ${link.colorClass}">
                        <fieldset class="tui-fieldset">
                            <legend>${link.terminalLegend} <span class="terminal-status checking" id="terminal-status-${uniqueLinkId}">WAIT</span></legend>
                            <div class="link-content">
                                <span class="icon-ascii">${link.icon}</span>
                                <div class="link-title">${link.shortTitle}</div>
                                <div class="link-description">${link.description}</div>
                                <div class="link-url">» ${link.displayUrl}</div>
                            </div>
                        </fieldset>
                    </div>
                `;
                container.appendChild(linkWindow);
            });

            // Start status checking if in terminal mode
            if (isTerminalMode) {
                setTimeout(() => {
                    checkAllStatuses();
                }, 100);
            }
        }

        // Generate terminal navigation bar
        function generateTerminalNav() {
            const navBar = document.getElementById('terminalNavBar');
            navBar.innerHTML = '';

            portalData.navigation.terminal.forEach(item => {
                const navItem = document.createElement('a');
                navItem.href = '#';
                navItem.className = 'nav-item';
                navItem.textContent = item.label;
                navItem.onclick = (e) => {
                    e.preventDefault();
                    window[item.action]();
                    return false;
                };
                navBar.appendChild(navItem);
            });
        }

        // Setup keyboard shortcuts
        function setupKeyboardShortcuts() {
            document.addEventListener('keydown', function(e) {
                if (isTerminalMode) {
                    const shortcut = portalData.navigation.shortcuts.find(s => s.key === e.key);
                    if (shortcut) {
                        e.preventDefault();
                        window[shortcut.action]();
                    }
                }
            });
        }

        // UI Toggle Functionality
        function toggleUI() {
            isTerminalMode = !isTerminalMode;
            const body = document.body;
            const toggleBtn = document.getElementById('uiToggleBtn');
            const terminalStyles = document.getElementById('terminal-styles');
            const tuicssLink = document.getElementById('tuicss-stylesheet');
            
            if (isTerminalMode) {
                // Switch to Terminal Mode
                body.classList.add('terminal-mode');
                terminalStyles.disabled = false;
                tuicssLink.disabled = false;
                toggleBtn.textContent = '🎨 Modern';
                
                // Initialize terminal UI features
                initTerminalUI();
                // Re-check statuses for terminal mode
                checkAllStatuses();
            } else {
                // Switch to Modern Mode
                body.classList.remove('terminal-mode');
                terminalStyles.disabled = true;
                tuicssLink.disabled = true;
                toggleBtn.textContent = '⚡ Terminal';
            }
            
            // Save preference to localStorage
            if (portalData?.config?.enableLocalStorage) {
                localStorage.setItem('uiMode', isTerminalMode ? 'terminal' : 'modern');
            }
        }

        // Load saved UI preference
        function loadUIPreference() {
            if (portalData?.config?.enableLocalStorage) {
                const savedMode = localStorage.getItem('uiMode');
                if (savedMode === 'terminal') {
                    toggleUI();
                }
            }
        }

        // Terminal UI Functions
        function initTerminalUI() {
            // Clock functionality for terminal mode
            if (!window.clockInterval) {
                function updateClock() {
                    const clockElement = document.getElementById('clock');
                    if (clockElement) {
                        const now = new Date();
                        const hours = String(now.getHours()).padStart(2, '0');
                        const minutes = String(now.getMinutes()).padStart(2, '0');
                        const seconds = String(now.getSeconds()).padStart(2, '0');
                        clockElement.textContent = `${hours}:${minutes}:${seconds}`;
                    }
                }
                window.clockInterval = setInterval(updateClock, 1000);
                updateClock();
            }

            // Terminal typing effect for title
            if (portalData?.config?.animations?.typing) {
                const titleElement = document.querySelector('.terminal-ui .title-text');
                if (titleElement && !titleElement.hasAttribute('data-typed')) {
                    titleElement.setAttribute('data-typed', 'true');
                    const originalText = portalData.portal.terminalTitle;
                    titleElement.innerHTML = '';
                    let index = 0;
                    
                    function typeText() {
                        if (index < originalText.length) {
                            titleElement.innerHTML = originalText.slice(0, index + 1);
                            index++;
                            setTimeout(typeText, 100);
                        } else {
                            titleElement.innerHTML = originalText + '<span class="cursor"></span>';
                        }
                    }
                    
                    setTimeout(typeText, 500);
                }
            }

            // ASCII art animation
            if (portalData?.config?.animations?.ascii && !window.asciiInterval) {
                const asciiChars = ['★', '◆', '■', '▲', '●', '✦', '◉', '◈'];
                let currentChar = 0;
                
                window.asciiInterval = setInterval(() => {
                    const decoration = document.querySelector('.terminal-ui .ascii-decoration');
                    if (decoration) {
                        decoration.textContent = asciiChars[currentChar];
                        currentChar = (currentChar + 1) % asciiChars.length;
                    }
                }, 3000);
            }
        }

        // Initialize UI features
        function initializeUIFeatures() {
            // Modern UI animations
            if (portalData?.config?.animations?.compass) {
                const compass = document.querySelector('.compass-background svg');
                if (compass) {
                    compass.style.transition = 'transform 2s ease-out';
                    setTimeout(() => {
                        compass.style.transform = 'rotate(360deg)';
                    }, 100);
                    setTimeout(() => {
                        compass.style.transition = '';
                        compass.style.transform = '';
                    }, 2100);
                }
            }
            
            // Add cursor movement on hover for modern UI
            const headerTitle = document.querySelector('.header h1');
            let hoveredCards = 0;
            
            document.querySelectorAll('.link-card').forEach(card => {
                card.addEventListener('mouseenter', () => {
                    hoveredCards++;
                    
                    // Hide title cursor when hovering a card
                    if (headerTitle) {
                        headerTitle.classList.add('cursor-hidden');
                    }
                    
                    // Add subtle pulse to compass when hovering cards
                    const compass = document.querySelector('.compass-background');
                    if (compass) {
                        compass.style.transition = 'opacity 0.3s ease';
                        compass.style.opacity = '0.7';
                    }
                });
                
                card.addEventListener('mouseleave', () => {
                    hoveredCards--;
                    
                    // Show title cursor when not hovering any card
                    if (hoveredCards === 0 && headerTitle) {
                        headerTitle.classList.remove('cursor-hidden');
                    }
                    
                    // Reset compass opacity
                    const compass = document.querySelector('.compass-background');
                    if (compass) {
                        compass.style.opacity = '0.5';
                    }
                });
            });
        }

        // Terminal mode helper functions
        function showAbout() {
            alert(`NStarX Portal v${portalData?.portal?.version || '1.0'}\n\nTerminal Interface for NStarX Resources\n\n© 2024 NStarX Corporation\nAll Rights Reserved`);
        }

        function showHelp() {
            alert('NAVIGATION HELP\n\n• Click on any window to open the link\n• Use F1 for help\n• Use F5 to refresh\n• Press ESC to exit\n\nKEYBOARD SHORTCUTS:\n• Tab - Navigate between links\n• Enter - Open selected link\n• Alt+← - Go back');
        }

        function refreshPage() {
            location.reload();
        }

        function exitPortal() {
            if (confirm('Exit portal?')) {
                window.close();
            }
        }

        // Status checking functionality
        const statusCache = new Map();
        let statusCheckInterval = null;

        // Ping Console Functions
        function togglePingConsole() {
            const console = document.getElementById('pingConsole');
            console.style.display = console.style.display === 'none' ? 'block' : 'none';
        }
        
        function clearPingConsole() {
            document.getElementById('pingOutput').innerHTML = '';
        }
        
        function pingLog(message, type = 'info') {
            const output = document.getElementById('pingOutput');
            const timestamp = new Date().toLocaleTimeString('en-US', { hour12: false });
            let color = '#0f0';
            let prefix = '';
            
            switch(type) {
                case 'success': 
                    color = '#0f0'; 
                    prefix = '✓';
                    break;
                case 'error': 
                    color = '#f00'; 
                    prefix = '✗';
                    break;
                case 'warning': 
                    color = '#ff0'; 
                    prefix = '⚠';
                    break;
                case 'ping': 
                    color = '#0ff'; 
                    prefix = '🔍';
                    break;
                default: 
                    color = '#fff'; 
                    prefix = '•';
            }
            
            const line = `<span style="color: #888">[${timestamp}]</span> <span style="color: ${color}">${prefix} ${message}</span>\n`;
            output.innerHTML += line;
            output.scrollTop = output.scrollHeight;
        }
        
        // Ping-style URL status checker with multiple detection methods
        async function checkUrlStatus(url) {
            console.log(`🔍 Pinging: ${url}`);
            pingLog(`PING ${url}`, 'ping');
            
            // First, check for mixed content issues
            if (url.startsWith('http://') && window.location.protocol === 'https:') {
                console.warn(`⚠️ ${url} - HTTP blocked from HTTPS context (mixed content)`);
                pingLog(`  HTTP blocked (mixed content policy)`, 'warning');
                return 'offline';
            }
            
            // Try multiple ping methods in sequence
            const pingMethods = [
                { name: 'Performance Ping', fn: performancePing },
                { name: 'Fetch Ping', fn: fetchPing },
                { name: 'Image Beacon', fn: imageBeaconPing },
                { name: 'Script Tag', fn: scriptTagPing }
            ];
            
            for (const method of pingMethods) {
                try {
                    console.log(`  Trying ${method.name}...`);
                    pingLog(`  Trying ${method.name}...`, 'info');
                    const startTime = performance.now();
                    const result = await method.fn(url);
                    const elapsed = Math.round(performance.now() - startTime);
                    
                    if (result !== 'unknown') {
                        console.log(`  ✓ ${method.name} result: ${result}`);
                        if (result === 'online') {
                            pingLog(`  ✓ ${method.name}: ONLINE (${elapsed}ms)`, 'success');
                        } else {
                            pingLog(`  ✗ ${method.name}: OFFLINE`, 'error');
                        }
                        return result;
                    }
                } catch (error) {
                    console.log(`  ✗ ${method.name} failed:`, error.message);
                    pingLog(`  ✗ ${method.name} failed: ${error.message}`, 'error');
                }
            }
            
            // If all methods fail, make an educated guess based on URL pattern
            const guess = guessStatusByPattern(url);
            pingLog(`  Final result: ${guess.toUpperCase()} (pattern-based)`, guess === 'online' ? 'warning' : 'error');
            return guess;
        }
        
        // Method 1: Use Performance API to measure actual network timing
        async function performancePing(url) {
            return new Promise((resolve) => {
                // This method works best for resources we can actually load
                const testUrl = new URL(url);
                const pingUrl = `${testUrl.origin}/favicon.ico?ping=${Date.now()}`;
                
                // Clear any existing entries
                if (performance.clearResourceTimings) {
                    performance.clearResourceTimings();
                }
                
                const img = new Image();
                const startMark = `ping-start-${Date.now()}`;
                const timeout = setTimeout(() => {
                    resolve('unknown');
                }, 2000);
                
                performance.mark(startMark);
                
                img.onload = img.onerror = () => {
                    clearTimeout(timeout);
                    const entries = performance.getEntriesByName(pingUrl);
                    if (entries.length > 0) {
                        const entry = entries[0];
                        // If we got timing data, server responded
                        if (entry.responseEnd > 0) {
                            resolve('online');
                        } else {
                            resolve('offline');
                        }
                    } else {
                        // No performance entry means blocked or failed
                        resolve('offline');
                    }
                };
                
                img.src = pingUrl;
            });
        }
        
        // Method 2: Fetch with controlled timeout
        async function fetchPing(url) {
            const controller = new AbortController();
            const timeout = setTimeout(() => controller.abort(), 3000);
            
            try {
                const startTime = Date.now();
                const response = await fetch(url, {
                    method: 'HEAD',
                    mode: 'no-cors',
                    signal: controller.signal,
                    cache: 'no-store',
                    redirect: 'follow'
                });
                clearTimeout(timeout);
                const endTime = Date.now();
                
                // In no-cors mode, we can't read the response but
                // if fetch completes without error, server is reachable
                console.log(`    Fetch completed in ${endTime - startTime}ms`);
                return 'online';
            } catch (error) {
                clearTimeout(timeout);
                if (error.name === 'AbortError') {
                    return 'offline'; // Timeout
                }
                // Network error
                return 'offline';
            }
        }
        
        // Method 3: Image beacon with better error handling
        async function imageBeaconPing(url) {
            return new Promise((resolve) => {
                const testUrl = new URL(url);
                const img = new Image();
                let resolved = false;
                
                const timeout = setTimeout(() => {
                    if (!resolved) {
                        resolved = true;
                        img.src = '';
                        resolve('offline');
                    }
                }, 3000);
                
                img.onload = () => {
                    if (!resolved) {
                        resolved = true;
                        clearTimeout(timeout);
                        resolve('online');
                    }
                };
                
                img.onerror = () => {
                    if (!resolved) {
                        resolved = true;
                        clearTimeout(timeout);
                        resolve('offline');
                    }
                };
                
                // Try multiple image paths
                const imagePaths = [
                    '/favicon.ico',
                    '/favicon.png',
                    '/apple-touch-icon.png',
                    '/robots.txt' // Some servers return images for any 404
                ];
                
                img.src = `${testUrl.origin}${imagePaths[0]}?_=${Date.now()}`;
            });
        }
        
        // Method 4: Script tag injection (works for some CORS-blocked sites)
        async function scriptTagPing(url) {
            return new Promise((resolve) => {
                const script = document.createElement('script');
                const timeout = setTimeout(() => {
                    document.head.removeChild(script);
                    resolve('unknown');
                }, 2000);
                
                script.onload = () => {
                    clearTimeout(timeout);
                    document.head.removeChild(script);
                    resolve('online');
                };
                
                script.onerror = () => {
                    clearTimeout(timeout);
                    document.head.removeChild(script);
                    resolve('offline');
                };
                
                // Try to load a small JS file (many sites have this)
                const testUrl = new URL(url);
                script.src = `${testUrl.origin}/robots.txt?callback=_&_=${Date.now()}`;
                script.async = true;
                document.head.appendChild(script);
            });
        }
        
        // Fallback: Make educated guess based on URL pattern
        function guessStatusByPattern(url) {
            console.log(`  ⚠️ All ping methods failed, guessing based on pattern`);
            
            // Known reliable domains
            if (url.includes('github.io')) {
                // GitHub Pages are usually reliable
                return 'online';
            }
            
            if (url.includes('ondigitalocean.app')) {
                // DigitalOcean apps are usually up
                return 'online';
            }
            
            if (url.includes('cloudapp.azure.com')) {
                // Azure apps might be behind firewall or down
                // Conservative approach
                return 'offline';
            }
            
            // Default to offline if we can't determine
            return 'offline';
        }

        async function updateLinkStatus(linkId, url) {
            try {
                // Update modern UI status
                const statusBadge = document.getElementById(`status-${linkId}`);
                const terminalStatus = document.getElementById(`terminal-status-${linkId}`);

                // Verify elements exist
                if (!statusBadge && !terminalStatus) {
                    console.warn(`Status elements not found for linkId: ${linkId}`);
                    return;
                }

                // Set to checking state
                if (statusBadge) {
                    statusBadge.className = 'status-badge checking';
                    statusBadge.innerHTML = `
                        <span class="status-dot"></span>
                        <span class="status-label">Checking</span>
                    `;
                }
                if (terminalStatus) {
                    terminalStatus.className = 'terminal-status checking';
                    terminalStatus.textContent = 'PING';
                }

                // Simulate response time
                const startTime = Date.now();
                
                // Check the actual status
                const status = await checkUrlStatus(url);
                const responseTime = Date.now() - startTime;
                statusCache.set(url, { status, timestamp: Date.now(), responseTime });

            // Update UI based on status with smooth transition
            if (statusBadge) {
                // Add transition effect
                statusBadge.style.transform = 'scale(0.95)';
                statusBadge.style.opacity = '0.8';
                
                setTimeout(() => {
                    statusBadge.className = `status-badge ${status}`;
                    const statusText = status === 'online' ? 'Online' : 'Offline';
                    const responseTimeText = responseTime < 500 ? 'Fast' : responseTime < 1000 ? 'Good' : 'Slow';
                    const lastChecked = new Date().toLocaleTimeString();
                    statusBadge.setAttribute('title', `Last checked: ${lastChecked}\nClick to refresh`);
                    statusBadge.innerHTML = `
                        <span class="status-dot"></span>
                        <span class="status-label">${statusText}</span>
                        ${status === 'online' && responseTime ? `<span class="response-time" title="${responseTime}ms">${responseTimeText}</span>` : ''}
                    `;
                    
                    // Restore scale
                    setTimeout(() => {
                        statusBadge.style.transform = '';
                        statusBadge.style.opacity = '';
                    }, 50);
                }, 100);
            }
            if (terminalStatus) {
                terminalStatus.className = `terminal-status ${status}`;
                if (status === 'online') {
                    terminalStatus.textContent = `UP:${responseTime}ms`;
                } else {
                    terminalStatus.textContent = 'DOWN';
                }
            }
            } catch (error) {
                console.error(`Error updating status for ${linkId}:`, error);
                // Set to offline on error
                const statusBadge = document.getElementById(`status-${linkId}`);
                const terminalStatus = document.getElementById(`terminal-status-${linkId}`);
                
                if (statusBadge) {
                    statusBadge.className = 'status-badge offline';
                    statusBadge.innerHTML = `
                        <span class="status-dot"></span>
                        <span class="status-label">Error</span>
                    `;
                }
                if (terminalStatus) {
                    terminalStatus.className = 'terminal-status offline';
                    terminalStatus.textContent = 'ERR';
                }
            }
        }

        async function checkAllStatuses() {
            if (!portalData || !portalData.links) return;

            const uniqueUrls = new Map();
            portalData.links.filter(link => link.enabled).forEach((link, index) => {
                const linkId = `link-${index}`; // Always use index for consistent unique ID
                if (!uniqueUrls.has(link.url)) {
                    uniqueUrls.set(link.url, []);
                }
                uniqueUrls.get(link.url).push(linkId);
            });

            // Check each unique URL
            for (const [url, linkIds] of uniqueUrls) {
                // Check cache first
                const cached = statusCache.get(url);
                const cacheAge = cached ? Date.now() - cached.timestamp : Infinity;
                
                if (cacheAge < 30000) { // Use cache if less than 30 seconds old
                    linkIds.forEach(linkId => {
                        const statusBadge = document.getElementById(`status-${linkId}`);
                        const terminalStatus = document.getElementById(`terminal-status-${linkId}`);
                        
                        if (statusBadge) {
                            statusBadge.className = `status-badge ${cached.status}`;
                            const statusText = cached.status === 'online' ? 'Online' : 'Offline';
                            const responseTimeText = cached.responseTime && cached.responseTime < 500 ? 'Fast' : cached.responseTime < 1000 ? 'Good' : 'Slow';
                            const lastChecked = new Date(cached.timestamp).toLocaleTimeString();
                            statusBadge.setAttribute('title', `Last checked: ${lastChecked}\nClick to refresh`);
                            statusBadge.setAttribute('onclick', `event.preventDefault(); event.stopPropagation(); updateLinkStatus('${linkId}', '${url}'); return false;`);
                            statusBadge.innerHTML = `
                                <span class="status-dot"></span>
                                <span class="status-label">${statusText}</span>
                                ${cached.status === 'online' && cached.responseTime ? `<span class="response-time" title="${cached.responseTime}ms">${responseTimeText}</span>` : ''}
                            `;
                        }
                        if (terminalStatus) {
                            terminalStatus.className = `terminal-status ${cached.status}`;
                            if (cached.status === 'online' && cached.responseTime) {
                                terminalStatus.textContent = `UP:${cached.responseTime}ms`;
                            } else {
                                terminalStatus.textContent = 'DOWN';
                            }
                        }
                    });
                } else {
                    // Check status for all link IDs with this URL
                    // Use Promise.all to update all statuses concurrently
                    Promise.all(linkIds.map(linkId => updateLinkStatus(linkId, url)));
                }
            }
        }

        // Auto-refresh status every 60 seconds
        function startStatusMonitoring() {
            if (statusCheckInterval) {
                clearInterval(statusCheckInterval);
            }
            statusCheckInterval = setInterval(() => {
                checkAllStatuses();
            }, 60000);
        }
        
        // Manual refresh all statuses
        function refreshAllStatuses() {
            // Clear cache to force fresh check
            statusCache.clear();
            
            // Visual feedback
            const refreshBtn = event?.target;
            if (refreshBtn) {
                const originalText = refreshBtn.textContent;
                refreshBtn.textContent = '⏳ Refreshing...';
                refreshBtn.disabled = true;
                
                setTimeout(() => {
                    refreshBtn.textContent = originalText;
                    refreshBtn.disabled = false;
                }, 2000);
            }
            
            // Check all statuses
            checkAllStatuses();
        }

        // Stop monitoring when page is hidden
        document.addEventListener('visibilitychange', () => {
            if (document.hidden) {
                if (statusCheckInterval) {
                    clearInterval(statusCheckInterval);
                    statusCheckInterval = null;
                }
            } else {
                checkAllStatuses();
                startStatusMonitoring();
            }
        });

        // Load portal data on page load
        window.addEventListener('DOMContentLoaded', () => {
            loadPortalData();
            // Note: startStatusMonitoring is now called from initializePortal after data loads
        });
    </script>
</body>
</html>